<!doctype html><html lang=en><head><meta charset=utf-8><meta name=generator content="Hugo 0.79.0"><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content="Anthony"><meta property="og:url" content="https://sudrizzz.github.io/posts/cmu-15-213-lesson3/"><link rel=canonical href=https://sudrizzz.github.io/posts/cmu-15-213-lesson3/><link rel=alternate type=application/atom+xml href=https://sudrizzz.github.ioindex.xml title="Anthony's Blog"><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/sudrizzz.github.io"},"articleSection":"posts","name":"CMU 15-213 存储器层次结构","headline":"CMU 15-213 存储器层次结构","description":"前言 本课的第三、四章分别是程序的机器级表示和处理器体系结构，由于过于硬核，此处略过。第五章是优化程序性能，讲解了如何最大限度地提高程序执行效能，此处也略过。本文基于第六章存储器层级结构。\n存储技术 在本节中主要介绍 SRAM 存储器、DRAM 存储器、ROM 存储器以及机械和固态硬盘。\n随机访问存储器 随机访问存储器（Random Access Memory, RAM）分为两类：静态的和动态的。静态随机访问存储器（Static Random Access Memory, SRAM）比动态随机访问存储器（Dynamic Random Access Memory, DRAM）更快，但也贵得多。目前 CPU 中的三级缓存都是 SRAM。\n易失性存储器 需要注意的是，虽然 SRAM 是静态随机访问存储器，但是其“静态”是相对于动态随机访问存储器的，仍然属于“易失性存储器”，而非真正意义上的静态，同时 DRAM 也属于“易失性存储器”。通俗的说，就是断电之后保存的信息就会丢失。\nSRAM SRAM 将每个位存储在一个双稳态的存储器单元中，每个单元是用一个六晶体管来实现的，在通电的情况下，它可以无限期地保持在两个不同的电压配置或状态之一，其他任何状态都是不稳定的。当从不稳定状态开始，电路会迅速转换到两个稳定状态中的一个。这样的存储器单元类似于下图倒转的钟摆模型。\n由于上述的特性（SRAM 的双稳态特性），只要有电，它就会永远保持它的值。即使有干扰（例如电子噪音）来扰乱电压，当干扰消除后，电路就会恢复到稳定值。这样体现了上述表格中的持续性和不敏感性。\nDRAM DRAM 将每个位存储位对一个电容的充电，每个单元由一个电容和一个访问晶体管组成。但是与 SRAM 不同，DRAM 存储单元对抗干扰非常敏感。当电容的电压被扰乱之后，它就永远不会恢复了。\n小结 下表总结了 SRAM 和 DRAM 存储器的特性。只要有供电，SRAM 就会保持不变。与 DRAM 不同，它不需要刷新。SRAM 的存取比 DRAM 快。SRAM 对诸如光和电噪声这样的干扰不敏感。代价是 SRAM 单元比 DRAM 单元使用更多的晶体管，因而密集度低，而且更贵，功耗更大。\n    每位晶体管数 相对访问时间 持续的？ 敏感的？ 相对花费 应用     SRAM 6 1X 是 否 1000x 高速缓存存储器   DRAM 1 10X 否 是 1X 主存，帧缓冲区    非易失性存储器 显然，非易失性存储器指即使断电也不会丢失数据的存储器，非易失性存储器包括以下几种：","inLanguage":"en-US","author":"Anthony","creator":"Anthony","publisher":"Anthony","accountablePerson":"Anthony","copyrightHolder":"Anthony","copyrightYear":"2020","datePublished":"2020-09-20 15:20:11 \u002b0800 \u002b0800","dateModified":"2020-09-20 15:20:11 \u002b0800 \u002b0800","url":"https:\/\/sudrizzz.github.io\/posts\/cmu-15-213-lesson3\/","keywords":[]}</script><title>CMU 15-213 存储器层次结构 - Anthony's Blog</title><meta property="og:title" content="CMU 15-213 存储器层次结构 - Anthony's Blog"><meta property="og:type" content="article"><meta property="og:description" content="前言 本课的第三、四章分别是程序的机器级表示和处理器体系结构，由于过于硬核，此处略过。第五章是优化程序性能，讲解了如何最大限度地提高程序执行效能，此处也略过。本文基于第六章存储器层级结构。
存储技术 在本节中主要介绍 SRAM 存储器、DRAM 存储器、ROM 存储器以及机械和固态硬盘。
随机访问存储器 随机访问存储器（Random Access Memory, RAM）分为两类：静态的和动态的。静态随机访问存储器（Static Random Access Memory, SRAM）比动态随机访问存储器（Dynamic Random Access Memory, DRAM）更快，但也贵得多。目前 CPU 中的三级缓存都是 SRAM。
易失性存储器 需要注意的是，虽然 SRAM 是静态随机访问存储器，但是其“静态”是相对于动态随机访问存储器的，仍然属于“易失性存储器”，而非真正意义上的静态，同时 DRAM 也属于“易失性存储器”。通俗的说，就是断电之后保存的信息就会丢失。
SRAM SRAM 将每个位存储在一个双稳态的存储器单元中，每个单元是用一个六晶体管来实现的，在通电的情况下，它可以无限期地保持在两个不同的电压配置或状态之一，其他任何状态都是不稳定的。当从不稳定状态开始，电路会迅速转换到两个稳定状态中的一个。这样的存储器单元类似于下图倒转的钟摆模型。
由于上述的特性（SRAM 的双稳态特性），只要有电，它就会永远保持它的值。即使有干扰（例如电子噪音）来扰乱电压，当干扰消除后，电路就会恢复到稳定值。这样体现了上述表格中的持续性和不敏感性。
DRAM DRAM 将每个位存储位对一个电容的充电，每个单元由一个电容和一个访问晶体管组成。但是与 SRAM 不同，DRAM 存储单元对抗干扰非常敏感。当电容的电压被扰乱之后，它就永远不会恢复了。
小结 下表总结了 SRAM 和 DRAM 存储器的特性。只要有供电，SRAM 就会保持不变。与 DRAM 不同，它不需要刷新。SRAM 的存取比 DRAM 快。SRAM 对诸如光和电噪声这样的干扰不敏感。代价是 SRAM 单元比 DRAM 单元使用更多的晶体管，因而密集度低，而且更贵，功耗更大。
    每位晶体管数 相对访问时间 持续的？ 敏感的？ 相对花费 应用     SRAM 6 1X 是 否 1000x 高速缓存存储器   DRAM 1 10X 否 是 1X 主存，帧缓冲区    非易失性存储器 显然，非易失性存储器指即使断电也不会丢失数据的存储器，非易失性存储器包括以下几种："><meta name=description content="前言 本课的第三、四章分别是程序的机器级表示和处理器体系结构，由于过于硬核，此处略过。第五章是优化程序性能，讲解了如何最大限度地提高程序执行效能，此处也略过。本文基于第六章存储器层级结构。
存储技术 在本节中主要介绍 SRAM 存储器、DRAM 存储器、ROM 存储器以及机械和固态硬盘。
随机访问存储器 随机访问存储器（Random Access Memory, RAM）分为两类：静态的和动态的。静态随机访问存储器（Static Random Access Memory, SRAM）比动态随机访问存储器（Dynamic Random Access Memory, DRAM）更快，但也贵得多。目前 CPU 中的三级缓存都是 SRAM。
易失性存储器 需要注意的是，虽然 SRAM 是静态随机访问存储器，但是其“静态”是相对于动态随机访问存储器的，仍然属于“易失性存储器”，而非真正意义上的静态，同时 DRAM 也属于“易失性存储器”。通俗的说，就是断电之后保存的信息就会丢失。
SRAM SRAM 将每个位存储在一个双稳态的存储器单元中，每个单元是用一个六晶体管来实现的，在通电的情况下，它可以无限期地保持在两个不同的电压配置或状态之一，其他任何状态都是不稳定的。当从不稳定状态开始，电路会迅速转换到两个稳定状态中的一个。这样的存储器单元类似于下图倒转的钟摆模型。
由于上述的特性（SRAM 的双稳态特性），只要有电，它就会永远保持它的值。即使有干扰（例如电子噪音）来扰乱电压，当干扰消除后，电路就会恢复到稳定值。这样体现了上述表格中的持续性和不敏感性。
DRAM DRAM 将每个位存储位对一个电容的充电，每个单元由一个电容和一个访问晶体管组成。但是与 SRAM 不同，DRAM 存储单元对抗干扰非常敏感。当电容的电压被扰乱之后，它就永远不会恢复了。
小结 下表总结了 SRAM 和 DRAM 存储器的特性。只要有供电，SRAM 就会保持不变。与 DRAM 不同，它不需要刷新。SRAM 的存取比 DRAM 快。SRAM 对诸如光和电噪声这样的干扰不敏感。代价是 SRAM 单元比 DRAM 单元使用更多的晶体管，因而密集度低，而且更贵，功耗更大。
    每位晶体管数 相对访问时间 持续的？ 敏感的？ 相对花费 应用     SRAM 6 1X 是 否 1000x 高速缓存存储器   DRAM 1 10X 否 是 1X 主存，帧缓冲区    非易失性存储器 显然，非易失性存储器指即使断电也不会丢失数据的存储器，非易失性存储器包括以下几种："><meta property="og:locale" content="zh-cn"><link rel=stylesheet href=/css/flexboxgrid-6.3.1.min.css><link rel=stylesheet href=/css/github-markdown.css><link rel=stylesheet href=/css/highlight/tomorrow.min.css><link rel=stylesheet href=/css/index.css><link href=/index.xml rel=alternate type=application/rss+xml title="Anthony's Blog"><link href="https://fonts.loli.net/css?family=Arvo|Permanent+Marker|Bree+Serif" rel=stylesheet></head><body><article class="post Chinese" id=article><div class=row><div class=col-xs-12><div class=site-header><header><div class="signatures site-title"><a href=/>Anthony</a></div></header><div class="row end-xs"></div><div class=header-line></div></div><header class=post-header><h1 class=post-title>CMU 15-213 存储器层次结构</h1><div class="row post-desc"><div class=col-xs-6><time class=post-date datetime="2020-09-20 15:20:11 +0800">2020.09.20</time></div><div class=col-xs-6><div class=post-author><a target=_blank href=https://github.com/sudrizzz/>@Anthony</a></div></div></div></header><div class="post-content markdown-body"><h1 id=前言>前言</h1><p>本课的第三、四章分别是程序的机器级表示和处理器体系结构，由于过于硬核，此处略过。第五章是优化程序性能，讲解了如何最大限度地提高程序执行效能，此处也略过。本文基于第六章存储器层级结构。</p><h1 id=存储技术>存储技术</h1><p>在本节中主要介绍 SRAM 存储器、DRAM 存储器、ROM 存储器以及机械和固态硬盘。</p><h2 id=随机访问存储器>随机访问存储器</h2><p>随机访问存储器（Random Access Memory, RAM）分为两类：静态的和动态的。静态随机访问存储器（Static Random Access Memory, SRAM）比动态随机访问存储器（Dynamic Random Access Memory, DRAM）更快，但也贵得多。目前 CPU 中的三级缓存都是 SRAM。</p><h3 id=易失性存储器>易失性存储器</h3><p>需要注意的是，虽然 SRAM 是静态随机访问存储器，但是其“静态”是相对于动态随机访问存储器的，仍然属于“易失性存储器”，而非真正意义上的静态，同时 DRAM 也属于“易失性存储器”。通俗的说，就是断电之后保存的信息就会丢失。</p><h4 id=sram>SRAM</h4><p>SRAM 将每个位存储在一个双稳态的存储器单元中，每个单元是用一个六晶体管来实现的，在通电的情况下，它可以无限期地保持在两个不同的电压配置或状态之一，其他任何状态都是不稳定的。当从不稳定状态开始，电路会迅速转换到两个稳定状态中的一个。这样的存储器单元类似于下图倒转的钟摆模型。</p><p><img src=https://cdn.jsdelivr.net/gh/sudrizzz/blog_images@main/20200918161742.png alt=20200918161742></p><p>由于上述的特性（SRAM 的双稳态特性），只要有电，它就会永远保持它的值。即使有干扰（例如电子噪音）来扰乱电压，当干扰消除后，电路就会恢复到稳定值。这样体现了上述表格中的持续性和不敏感性。</p><h4 id=dram>DRAM</h4><p>DRAM 将每个位存储位对一个电容的充电，每个单元由一个电容和一个访问晶体管组成。但是与 SRAM 不同，DRAM 存储单元对抗干扰非常敏感。当电容的电压被扰乱之后，它就永远不会恢复了。</p><h4 id=小结>小结</h4><p>下表总结了 SRAM 和 DRAM 存储器的特性。只要有供电，SRAM 就会保持不变。与 DRAM 不同，它不需要刷新。SRAM 的存取比 DRAM 快。SRAM 对诸如光和电噪声这样的干扰不敏感。代价是 SRAM 单元比 DRAM 单元使用更多的晶体管，因而密集度低，而且更贵，功耗更大。</p><table><thead><tr><th style=text-align:center></th><th style=text-align:center>每位晶体管数</th><th style=text-align:center>相对访问时间</th><th style=text-align:center>持续的？</th><th style=text-align:center>敏感的？</th><th style=text-align:center>相对花费</th><th style=text-align:center>应用</th></tr></thead><tbody><tr><td style=text-align:center>SRAM</td><td style=text-align:center>6</td><td style=text-align:center>1X</td><td style=text-align:center>是</td><td style=text-align:center>否</td><td style=text-align:center>1000x</td><td style=text-align:center>高速缓存存储器</td></tr><tr><td style=text-align:center>DRAM</td><td style=text-align:center>1</td><td style=text-align:center>10X</td><td style=text-align:center>否</td><td style=text-align:center>是</td><td style=text-align:center>1X</td><td style=text-align:center>主存，帧缓冲区</td></tr></tbody></table><h3 id=非易失性存储器>非易失性存储器</h3><p>显然，非易失性存储器指即使断电也不会丢失数据的存储器，非易失性存储器包括以下几种：</p><ul><li>只读存储器（Read-Only Memory, ROM）：在生产期间被编程，虽然 ROM 中有的类型既可以读也可以写，但是他们整体上都被称为只读存储器</li><li>可编程存储器（Programmable ROM, PROM）：只能被编程一次</li><li>可擦写可编程存储器（Eraseable PROM, EPROM）：有一个透明的石英窗口，允许光到达存储单元。紫外线或者 X 射线照射透过窗口，EPROM 单元就被清除为 0。对 EPROM 编程时通过使用一种把 1 写入 EPROM 的特殊设备来完成的，EPROM 能够被擦除和重编程的次数的数量级可以达到 1000 次</li><li>电子可擦除可编程存储器（Electrically Eraseable PROM, EEPROM）：类似与 EPROM，但它不需要独立的编程设备，可以直接在印刷电路板上编程，EEPROM 可以编程的次数的数量级可以达到 $ 10^{5} $ 次</li><li>闪存（Flash Memory）：基于 EEPROM，多用于手机、相机等产品中，大约 100000 次擦写后失效</li></ul><p>需要说明的是，存储在 ROM 设备中的程序通常被称为固件（firmware）。例如 BIOS、磁盘驱动控制器、显卡驱动控制器等等。</p><h3 id=访问主存>访问主存</h3><p>数据流通过称为总线（bus）的共享电子电路在处理器和 DRAM 主存之间来来回回。例如下图中，连接 I/O 桥接器与总线接口的系统总线（system bus），连接主存与 I/O 桥接器的内存总线(memory bus)。</p><p><img src=https://cdn.jsdelivr.net/gh/sudrizzz/blog_images@main/20200918171907.png alt=20200918171907></p><h4 id=从主存读数据>从主存读数据</h4><p>数据移动路径：主存 -> 内存总线 -> I/O 桥接器 -> 系统总线 -> 总线接口 -> 寄存器</p><h4 id=从主存写数据>从主存写数据</h4><p>数据移动路径：寄存器 -> 总线接口 -> 系统总线 -> I/O 桥接器 -> 内存总线 -> 主存</p><h2 id=机械硬盘>机械硬盘</h2><h3 id=构造>构造</h3><p>磁盘是由盘片（platter）组成的，每个盘片有两个表面（surface）。盘片中央有一个可以旋转的主轴（spindle），它使得盘片以固定的旋转速率（rotational rate）旋转，通常是 5400-15000 转每分钟（Revolution Per Minute，RPM）。磁盘通常包含一个或多个盘片，并封装在一个密闭的空间中。</p><p><img src=https://cdn.jsdelivr.net/gh/sudrizzz/blog_images@main/20200921102634.png alt=20200921102634></p><p>每个盘片的表面是由一组磁道（track）同心圆组成的，每个磁道又被划分为一组扇区（sector）。每个扇区包含相等数据量的数据位（通常是 512 字节），扇区之间由一些间隙（gap）隔开，间隙存储用来表示扇区的格式化位。</p><p><img src=https://cdn.jsdelivr.net/gh/sudrizzz/blog_images@main/20200921102745.png alt=20200921102745></p><h3 id=容量>容量</h3><p>在磁盘容量的计算中，总是按照 1000 进制为准，例如 $ 1GB = 10^{9} Bytes $</p><p>磁盘容量是由以下技术因素决定的：</p><ul><li>记录密度（Recording density）（位/英寸）：磁道一英寸的段中可以放入的位数</li><li>磁道密度（Track density）（道/英寸）：从盘片中心出发半径一英寸的段内可以有的磁道数</li><li>面密度（Areal density）（位/平方英寸）：记录密度与磁道密度的乘积</li></ul><p>磁盘容量的计算方式：</p><p>$$ 磁盘容量 = \frac{字节数}{扇区} \times \frac{平均扇区数}{磁道} \times \frac{磁道数}{表面} \times \frac{表面数}{盘片} \times \frac{盘片数}{磁道} $$</p><p>例如现有一磁盘，总共有 5 个盘片，每个盘片有 2 个表面，每个表面有 20000 个磁道，每个磁道平均有 300 个扇区，每个扇区有 512 个字节，计算其磁盘容量。</p><p>$$
\begin{aligned}
磁盘容量 &= \frac{512 字节}{扇区} \times \frac{300 扇区}{磁盘} \times \frac{20000 磁道}{表面} \times \frac{2 表面}{盘片} \times \frac{5盘片}{磁盘} \newline
&= 512 \times 300 \times 20000 \times 2 \times 5 \ Byte \newline
&= 30.72 \ GB
\end{aligned}
$$</p><h2 id=固态硬盘>固态硬盘</h2><p>固态硬盘示意图如下：</p><p><img src=https://cdn.jsdelivr.net/gh/sudrizzz/blog_images@main/20200922160917.png alt=20200922160917></p><p>一个固态硬盘由 B 个块的序列组成，每个块由 P 页组成。通常，页的大小是 512 字节~4KB，块是由 32~128 页组成的，块的大小为 16KB~512KB。数据是以页为单位读写的，只有在一页所属的块整个被擦除之后，才能写这一页（通常是指该块中的所有位都被设置为 1）。在进行 100000 次重复写之后，块将会磨损损坏。</p><h3 id=分类>分类</h3><p>现阶段的固态硬盘主要分为以下几类</p><ul><li>单阶存储单元（Single-Level Cell，SLC）：一个存储单元能存储 1 bit 信息，SLC 闪存的优点是传输速度更快，功率消耗更低和存储单元的寿命更长</li><li>多阶存储单元（Multi-Level Cell，MLC）：一个存储单元能存储 2 bit 信息，MLC 闪存可降低生产成本，但比起 SLC 闪存，其传输速度较慢，功率消耗较高和存储单元的寿命较低</li><li>三阶存储单元（Triple-Level Cell，TLC）：一个存储单元能存储 3 bit 信息，TLC 的写入速度比 SLC 和 MLC 慢，寿命也比 SLC 和 MLC 短（使用 LDPC 的话，约有 1500 次），大约 1000 次</li><li>四阶存储单元（Quad-Level Cell，QLC）：一个存储单元能存储 4 bit 信息，寿命为四者之中最短，大约只有 500 次</li></ul><p>在假设低电位表示二进制的 0，高电位表示二进制的 1 时，SLC、MLC、TLC 和 QLC 的电位及二进制值对比表如下。</p><p><img src=https://cdn.jsdelivr.net/gh/sudrizzz/blog_images@main/20200922162556.png alt=20200922162556></p><h3 id=对比机械硬盘>对比机械硬盘</h3><h4 id=优点>优点</h4><ul><li>固态硬盘没有移动部件，因而随机访问时间比机械硬盘快得多，能耗更低，同时也更结实。</li></ul><h4 id=缺点>缺点</h4><ul><li>在反复写之后，固态硬盘存储单元容易磨损</li><li>固态硬盘成本更高，相对容量更小</li></ul><h3 id=应用>应用</h3><ul><li>智能手机</li><li>笔记本电脑，PC</li><li>服务器</li></ul><h1 id=发展趋势>发展趋势</h1><p>下图以半对数为比例，画出了各类存储以及 CPU 性能的发展趋势。</p><p><img src=https://cdn.jsdelivr.net/gh/sudrizzz/blog_images@main/20200924145622.png alt=20200924145622></p><h1 id=局部性>局部性</h1><p>一个编写良好的计算机程序常常具有良好的局部性（locality）。也就是它们倾向于引用邻近与其他最近引用过的数据项的数据项，或者最近引用过的数据项本身。局部性通常有两种不同的形式：时间局部性（temporal locality）和空间局部性（spatial locality）。</p><p>下面是一些量化评价程序中局部性的一些简单原则：</p><ul><li>重复引用相同变量的程序由良好的时间局部性</li><li>对于具有步长为 k 的引用模式的程序，步长越小空间局部性越好。具有步长为 1 的引用模式的程序有很好的空间局部性。在内容中以大步长跳来跳去的程序空间局部性会很差</li><li>对于取质量来说，循环有好的时间和空间局部性。循环体越小，循环迭代次数越多，局部性越好</li></ul><h1 id=存储器层次结构>存储器层次结构</h1><p>存储器层次结构（Memory Hierarchy）如下图所示，越靠近底部的存储器速度越慢单价越低，越靠近顶部的则反之。</p><p><img src=https://cdn.jsdelivr.net/gh/sudrizzz/blog_images@main/20200924160033.png alt=20200924160033></p><h2 id=缓存>缓存</h2><h3 id=简介>简介</h3><p>缓存（Cache）是一种容量小但速度极快的存储设备，速度仅次于 CPU 寄存器。它充当速度较慢、容量较大的存储设备的临时存储区。</p><h3 id=层次结构的基本思想>层次结构的基本思想</h3><p>对于第 k 层更快更小的存储设备都充当了第 k+1 层更慢更小的存储设备的缓存。</p><h3 id=存储结构产生的原因>存储结构产生的原因</h3><p>由于局部性，程序通常更倾向于访问第 k 层存储器的数据，而非第 k+1 层存储器的数据。因此，第 k+1 层存储器设备可以做得速度更慢，容量更大以及单价更便宜。</p><h3 id=存储器层次结构中的缓存示例>存储器层次结构中的缓存示例</h3><p><img src=https://cdn.jsdelivr.net/gh/sudrizzz/blog_images@main/20200924155525.png alt=20200924155525></p><h1 id=参考文献>参考文献</h1><ol><li><a href=https://zh.wikipedia.org/wiki/%E9%97%AA%E5%AD%98>https://zh.wikipedia.org/wiki/%E9%97%AA%E5%AD%98</a></li><li><a href=https://www.bilibili.com/video/av61437877>https://www.bilibili.com/video/av61437877</a></li></ol></div><div class="row middle-xs"><div class=col-xs-12><div class=post-category><a href=/categories/csapp>CSAPP</a></div></div></div><div class=row><div class=col-xs-12></div></div><div style=height:50px></div><script>MathJax={tex:{inlineMath:[["$","$"],["\\(","\\)"],],},};</script><script id=MathJax-script async src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js></script><div class=site-footer><div class=site-footer-item><a href=https://github.com/sudrizzz/ target=_blank>Github</a></div><div class=site-footer-item><a href=mailto:sudrizzz@google.com target=_blank>Email</a></div><div class=site-footer-item><a href="https://music.163.com/song?id=356827" target=_blank>~</a></div></div></div></div></article><script src=/js/highlight.pack.js></script><script src=/js/lazyload.min.js></script><script>var lazyImage=new LazyLoad({container:document.getElementById('article')});</script><script>hljs.initHighlightingOnLoad();</script></body></html>